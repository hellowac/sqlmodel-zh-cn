# ä½¿ç”¨ FastAPI æ›´æ–°æ•°æ®

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ **FastAPI** çš„ *è·¯å¾„æ“ä½œ* æ¥æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚

## `HeroUpdate` æ¨¡å‹

æˆ‘ä»¬å¸Œæœ›å®¢æˆ·ç«¯èƒ½å¤Ÿæ›´æ–°è‹±é›„çš„ `name`ã€`secret_name` å’Œ `age`ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä»–ä»¬åœ¨æ›´æ–°å•ä¸ªå­—æ®µæ—¶å¿…é¡»é‡æ–°æä¾›æ‰€æœ‰æ•°æ®ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›å­—æ®µ **æ ‡è®°ä¸ºå¯é€‰**ã€‚

ç”±äº `HeroBase` ä¸­çš„ä¸€äº›å­—æ®µæ˜¯ *å¿…éœ€çš„*ï¼Œè€Œä¸æ˜¯å¯é€‰çš„ï¼Œå› æ­¤æˆ‘ä»¬å°†éœ€è¦ **åˆ›å»ºä¸€ä¸ªæ–°æ¨¡å‹**ã€‚

/// tip

è¿™æ˜¯ä¸€ä¸ªå¯èƒ½æ›´é€‚åˆä½¿ç”¨ **ç‹¬ç«‹æ¨¡å‹** çš„æƒ…å†µï¼Œè€Œä¸æ˜¯è¯•å›¾é€šè¿‡åˆ›å»ºå¤æ‚çš„ç»§æ‰¿æ¨¡å‹æ ‘æ¥è§£å†³é—®é¢˜ã€‚

å› ä¸ºæ¯ä¸ªå­—æ®µ **å®é™…ä¸Šæ˜¯ä¸åŒçš„**ï¼ˆæˆ‘ä»¬åªæ˜¯å°†å…¶æ›´æ”¹ä¸º `Optional`ï¼Œä½†è¿™å·²ç»ä½¿å®ƒä¸åŒï¼‰ï¼Œå› æ­¤å°†å®ƒä»¬æ”¾å…¥è‡ªå·±çš„æ¨¡å‹ä¸­æ˜¯åˆç†çš„ã€‚

///

æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºè¿™ä¸ªæ–°çš„ `HeroUpdate` æ¨¡å‹ï¼š

//// tab | Python 3.10+

```Python hl_lines="21-24"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py[ln:5-26]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.9+

```Python hl_lines="21-24"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py[ln:7-28]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.7+

```Python hl_lines="21-24"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001.py[ln:7-28]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

/// details | ğŸ‘€ å®Œæ•´æ–‡ä»¶é¢„è§ˆ

//// tab | Python 3.10+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py!}
```

////

//// tab | Python 3.9+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py!}
```

////

//// tab | Python 3.7+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001.py!}
```

////

///

è¿™å‡ ä¹ä¸ `HeroBase` ç›¸åŒï¼Œä½†æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ç®€å•åœ°ä» `HeroBase` ç»§æ‰¿ã€‚

## åˆ›å»ºæ›´æ–°è·¯å¾„æ“ä½œ

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨ *è·¯å¾„æ“ä½œ* ä¸­ä½¿ç”¨è¿™ä¸ªæ¨¡å‹æ¥æ›´æ–°è‹±é›„ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ `PATCH` HTTP æ“ä½œã€‚è¿™ç”¨äº **éƒ¨åˆ†æ›´æ–°æ•°æ®**ï¼Œæ­£æ˜¯æˆ‘ä»¬æ‰€åšçš„æ“ä½œã€‚

//// tab | Python 3.10+

```Python hl_lines="3-4"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py[ln:74-89]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.9+

```Python hl_lines="3-4"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.7+

```Python hl_lines="3-4"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

/// details | ğŸ‘€ å®Œæ•´æ–‡ä»¶é¢„è§ˆ

//// tab | Python 3.10+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py!}
```

////

//// tab | Python 3.9+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py!}
```

////

//// tab | Python 3.7+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001.py!}
```

////

///

æˆ‘ä»¬è¿˜ä» *è·¯å¾„å‚æ•°* å’Œè¯·æ±‚ä½“ä¸­è¯»å– `hero_id` å’Œ `HeroUpdate`ã€‚

### è¯»å–ç°æœ‰çš„è‹±é›„

æˆ‘ä»¬é€šè¿‡ **hero_id** è·å–æƒ³è¦æ›´æ–°çš„è‹±é›„çš„ **ID**ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸ **è¯»å–å•ä¸ªè‹±é›„** æ—¶ç›¸åŒçš„é€»è¾‘ä»æ•°æ®åº“ä¸­è¯»å–è‹±é›„ï¼Œæ£€æŸ¥å…¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯ç»™å®¢æˆ·ç«¯ï¼Œç­‰ç­‰ã€‚

//// tab | Python 3.10+

```Python hl_lines="6-8"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py[ln:74-89]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.9+

```Python hl_lines="6-8"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.7+

```Python hl_lines="6-8"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

/// details | ğŸ‘€ å®Œæ•´æ–‡ä»¶é¢„è§ˆ

//// tab | Python 3.10+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py!}
```

////

//// tab | Python 3.9+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py!}
```

////

//// tab | Python 3.7+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001.py!}
```

////

///

### è·å–æ–°çš„æ•°æ®

`HeroUpdate` æ¨¡å‹åŒ…å«æ‰€æœ‰å…·æœ‰ **é»˜è®¤å€¼** çš„å­—æ®µï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚

ä½†è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥è°ƒç”¨ `hero.model_dump()`ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå­—å…¸ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å¤šä¸ªæˆ–æ‰€æœ‰é»˜è®¤å€¼å­—æ®µï¼Œä¾‹å¦‚ï¼š

```Python
{
    "name": None,
    "secret_name": None,
    "age": None,
}
```

ç„¶åï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™äº›æ•°æ®æ›´æ–°æ•°æ®åº“ä¸­çš„è‹±é›„ï¼Œæˆ‘ä»¬å°†ä¼šåˆ é™¤ä»»ä½•ç°æœ‰çš„å€¼ï¼Œè€Œè¿™å¯èƒ½ **ä¸æ˜¯å®¢æˆ·ç«¯çš„æ„å›¾**ã€‚

å¹¸è¿çš„æ˜¯ï¼ŒPydantic æ¨¡å‹ï¼ˆä»¥åŠ SQLModel æ¨¡å‹ï¼‰æä¾›äº†ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `.model_dump()` æ–¹æ³•ä¸­ä¼ é€’ï¼š`exclude_unset=True`ã€‚

è¿™å‘Šè¯‰ Pydantic **ä¸åŒ…æ‹¬** å®¢æˆ·ç«¯ **æ²¡æœ‰å‘é€** çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒåªä¼š **åŒ…æ‹¬** å®¢æˆ·ç«¯ **å‘é€çš„å€¼**ã€‚

å› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ²¡æœ‰å€¼çš„ JSONï¼š

```JSON
{}
```

é‚£ä¹ˆï¼Œä½¿ç”¨ `hero.model_dump(exclude_unset=True)` è·å–çš„å­—å…¸å°†æ˜¯ï¼š

```Python
{}
```

ä½†å¦‚æœå®¢æˆ·ç«¯å‘é€çš„ JSON åŒ…å«ï¼š

```JSON
{
    "name": "Deadpuddle"
}
```

é‚£ä¹ˆï¼Œä½¿ç”¨ `hero.model_dump(exclude_unset=True)` è·å–çš„å­—å…¸å°†æ˜¯ï¼š

```Python
{
    "name": "Deadpuddle"
}
```

ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ•°æ®æ¥æ›´æ–°å®¢æˆ·ç«¯å®é™…å‘é€çš„æ•°æ®ï¼š

//// tab | Python 3.10+

```Python hl_lines="9"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py[ln:74-89]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.9+

```Python hl_lines="9"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.7+

```Python hl_lines="9"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

/// details | ğŸ‘€ å®Œæ•´æ–‡ä»¶é¢„è§ˆ

//// tab | Python 3.10+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py!}
```

////

//// tab | Python 3.9+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py!}
```

////

//// tab | Python 3.7+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001.py!}
```

////

///

/// tip

åœ¨ SQLModel 0.0.14 ä¹‹å‰ï¼Œæ–¹æ³•åæ˜¯ `hero.dict(exclude_unset=True)`ï¼Œä½†ä¸ºäº†ä¸ Pydantic v2 ä¿æŒä¸€è‡´ï¼Œå®ƒè¢«é‡å‘½åä¸º `hero.model_dump(exclude_unset=True)`ã€‚

///

## åœ¨æ•°æ®åº“ä¸­æ›´æ–°è‹±é›„

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº† **å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å­—å…¸**ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `db_hero.sqlmodel_update()` æ–¹æ³•æ¥æ›´æ–°å¯¹è±¡ `db_hero`ã€‚

//// tab | Python 3.10+

```Python hl_lines="10"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py[ln:74-89]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.9+

```Python hl_lines="10"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

//// tab | Python 3.7+

```Python hl_lines="10"
# ä»£ç çœç•¥ ğŸ‘†

{!./docs_src/tutorial/fastapi/update/tutorial001.py[ln:76-91]!}

# ä»£ç çœç•¥ ğŸ‘‡
```

////

/// details | ğŸ‘€ å®Œæ•´æ–‡ä»¶é¢„è§ˆ

//// tab | Python 3.10+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py310.py!}
```

////

//// tab | Python 3.9+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001_py39.py!}
```

////

//// tab | Python 3.7+

```Python
{!./docs_src/tutorial/fastapi/update/tutorial001.py!}
```

////

///

/// tip

`db_hero.sqlmodel_update()` æ–¹æ³•æ˜¯åœ¨ SQLModel 0.0.16 ä¸­æ–°å¢çš„ã€‚ğŸ¤“

åœ¨é‚£ä¹‹å‰ï¼Œä½ éœ€è¦æ‰‹åŠ¨è·å–å€¼å¹¶ä½¿ç”¨ `setattr()` è®¾ç½®å®ƒä»¬ã€‚

///

`db_hero.sqlmodel_update()` æ–¹æ³•æ¥å—ä¸€ä¸ªæ¨¡å‹å¯¹è±¡æˆ–å­—å…¸ä½œä¸ºå‚æ•°ã€‚

å¯¹äº **åŸå§‹** æ¨¡å‹å¯¹è±¡ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º `db_hero`ï¼‰ä¸­çš„æ¯ä¸ªå­—æ®µï¼Œå®ƒä¼šæ£€æŸ¥è¯¥å­—æ®µæ˜¯å¦åœ¨ **å‚æ•°**ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º `hero_data`ï¼‰ä¸­å­˜åœ¨ï¼Œç„¶åä½¿ç”¨æä¾›çš„å€¼è¿›è¡Œæ›´æ–°ã€‚

## ç§»é™¤å­—æ®µ

è¿™é‡Œæœ‰ä¸€ä¸ªé™„åŠ åŠŸèƒ½ã€‚ğŸ

å½“è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®å­—å…¸æ—¶ï¼Œæˆ‘ä»¬åªåŒ…å« **å®¢æˆ·ç«¯å®é™…å‘é€çš„å†…å®¹**ã€‚

è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†å®ƒæœ‰ä¸€äº›é¢å¤–çš„ç»†èŠ‚ï¼Œæˆä¸ºäº† **å¾ˆæ£’çš„ç‰¹æ€§**ã€‚âœ¨

æˆ‘ä»¬ **ä¸æ˜¯ç®€å•åœ°çœç•¥** å…·æœ‰ **é»˜è®¤å€¼** çš„æ•°æ®ã€‚

æˆ‘ä»¬ä¹Ÿ **ä¸æ˜¯ç®€å•åœ°çœç•¥** ä»»ä½•ä¸º `None` çš„æ•°æ®ã€‚

è¿™æ„å‘³ç€ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„æ¨¡å‹ **æœ‰ä¸€ä¸ªä¸é»˜è®¤å€¼ä¸åŒçš„å€¼**ï¼Œå®¢æˆ·ç«¯å¯ä»¥ **å°†å…¶é‡ç½®ä¸ºä¸é»˜è®¤å€¼ç›¸åŒçš„å€¼**ï¼Œç”šè‡³æ˜¯ `None`ï¼Œæˆ‘ä»¬ **ä»ç„¶ä¼šæ³¨æ„åˆ°** å¹¶ **æ ¹æ®éœ€è¦æ›´æ–°** å®ƒã€‚ğŸ¤¯ğŸš€

å› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯æƒ³æœ‰æ„åˆ é™¤è‹±é›„çš„ `age` å­—æ®µï¼Œä»–ä»¬åªéœ€å‘é€ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„ JSONï¼š

```JSON
{
    "age": null
}
```

ç„¶åï¼Œå½“ä½¿ç”¨ `hero.model_dump(exclude_unset=True)` è·å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ï¼š

```Python
{
    "age": None
}
```

å› æ­¤ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¯¥å€¼å¹¶å°†æ•°æ®åº“ä¸­çš„ `age` æ›´æ–°ä¸º `None`ï¼Œ**æ­£å¦‚å®¢æˆ·ç«¯æ‰€å¸Œæœ›çš„é‚£æ ·**ã€‚

è¯·æ³¨æ„ï¼Œ`age` è¿™é‡Œæ˜¯ `None`ï¼Œå¹¶ä¸” **æˆ‘ä»¬ä»ç„¶æ£€æµ‹åˆ°äº†è¿™ä¸€ç‚¹**ã€‚

å¦å¤–ï¼Œ`name` ç”šè‡³æ²¡æœ‰å‘é€ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ *é”™è¯¯åœ°* å°†å…¶è®¾ç½®ä¸º `None` æˆ–å…¶ä»–å†…å®¹ã€‚æˆ‘ä»¬åªæ˜¯æ²¡æœ‰æ›´æ”¹å®ƒï¼Œå› ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰å‘é€å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ **å®Œå…¨æ²¡æœ‰é—®é¢˜**ï¼Œå³ä½¿åœ¨è¿™äº›è¾¹ç¼˜æƒ…å†µä¸­ã€‚âœ¨

è¿™äº›æ˜¯ä½¿ç”¨ Pydantic å’Œ SQLModel çš„ä¸€äº›ä¼˜åŠ¿ã€‚ğŸ‰

## æ€»ç»“

é€šè¿‡åœ¨ SQLModel æ¨¡å‹ï¼ˆå’Œ Pydantic æ¨¡å‹ï¼‰ä¸­ä½¿ç”¨ `.model_dump(exclude_unset=True)`ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾ã€**æ­£ç¡®åœ°** æ›´æ–°æ•°æ®ï¼Œå³ä½¿æ˜¯åœ¨ **è¾¹ç¼˜æƒ…å†µ** ä¸‹ã€‚ğŸ˜